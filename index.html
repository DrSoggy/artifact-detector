<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Echo Detector</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
  font-family: monospace;
  color: #0f0;
}

canvas {
  position: absolute;
  inset: 0;
  filter: drop-shadow(0 0 12px #0f0);
}

#ui {
  position: absolute;
  inset: 0;
  pointer-events: none;
  padding: 10px;
}

.bar {
  height: 10px;
  border: 1px solid #0f0;
  margin-top: 4px;
}

.fill {
  height: 100%;
  background: #0f0;
  width: 0%;
}

.label {
  font-size: 12px;
  margin-top: 6px;
}
</style>
</head>

<body>
<canvas id="radar"></canvas>

<div id="ui">
  <div class="label">ECHO DETECTOR</div>
  <div class="label">SIGNAL</div>
  <div class="bar"><div id="signalBar" class="fill"></div></div>

  <div class="label">RADIATION</div>
  <div class="bar"><div id="radBar" class="fill"></div></div>

  <div class="label">ARTIFACT:</div>
  <div id="artifactName">NONE</div>
</div>

<script>
const canvas = document.getElementById("radar");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

let sweep = 0;
let blip = null;
let signalStrength = 0;

const artifacts = [
  "STONE BLOOD",
  "MOONLIGHT",
  "FLASH",
  "SOUL",
  "MEAT CHUNK",
  "SPARKLER",
  "CRYSTAL"
];

// Audio (iOS-safe)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function beep(duration) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.frequency.value = 900;
  gain.gain.value = 0.08;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

function drawRadar() {
  const w = canvas.width;
  const h = canvas.height;
  const cx = w / 2;
  const cy = h / 2;
  const r = Math.min(w, h) * 0.38;

  ctx.fillStyle = "rgba(0,0,0,0.25)";
  ctx.fillRect(0,0,w,h);

  ctx.strokeStyle = "#0f0";
  ctx.lineWidth = 1.5;

  for (let i = 1; i <= 4; i++) {
    ctx.beginPath();
    ctx.arc(cx, cy, r * i/4, 0, Math.PI*2);
    ctx.stroke();
  }

  ctx.beginPath();
  ctx.moveTo(cx-r, cy);
  ctx.lineTo(cx+r, cy);
  ctx.moveTo(cx, cy-r);
  ctx.lineTo(cx, cy+r);
  ctx.stroke();

  const sx = cx + Math.cos(sweep) * r;
  const sy = cy + Math.sin(sweep) * r;

  const grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, r);
  grad.addColorStop(0,"rgba(0,255,0,0.25)");
  grad.addColorStop(1,"rgba(0,255,0,0)");

  ctx.fillStyle = grad;
  ctx.beginPath();
  ctx.moveTo(cx,cy);
  ctx.lineTo(sx,sy);
  ctx.arc(cx,cy,r,sweep-0.05,sweep+0.05);
  ctx.closePath();
  ctx.fill();

  if (blip) {
    ctx.fillStyle = "rgba(0,255,0,0.9)";
    ctx.beginPath();
    ctx.arc(blip.x, blip.y, 6, 0, Math.PI*2);
    ctx.fill();
  }

  // Scanlines
  ctx.fillStyle = "rgba(0,255,0,0.03)";
  for (let y = 0; y < h; y += 4) {
    ctx.fillRect(0,y,w,1);
  }

  sweep += 0.035;
}

function loop() {
  drawRadar();
  requestAnimationFrame(loop);
}
loop();

function detect() {
  audioCtx.resume();

  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const r = Math.min(canvas.width, canvas.height) * 0.38;

  const angle = Math.random() * Math.PI * 2;
  const dist = Math.random() * r;

  blip = {
    x: cx + Math.cos(angle) * dist,
    y: cy + Math.sin(angle) * dist
  };

  signalStrength = Math.max(0, 1 - dist / r);

  document.getElementById("signalBar").style.width =
    Math.floor(signalStrength * 100) + "%";

  document.getElementById("radBar").style.width =
    Math.floor((0.3 + Math.random() * 0.6) * 100) + "%";

  document.getElementById("artifactName").textContent =
    artifacts[Math.floor(Math.random() * artifacts.length)];

  beep(0.04 + signalStrength * 0.12);

  if (navigator.vibrate) {
    navigator.vibrate(40 + signalStrength * 120);
  }
}

canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  detect();
});
canvas.addEventListener("mousedown", detect);
</script>
</body>
</html>
